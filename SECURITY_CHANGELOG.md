# üîê Changelog –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ GoalBuddy21 v1.1

## –î–∞—Ç–∞: 2025-11-13

## –û–±–∑–æ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π

–í –≤–µ—Ä—Å–∏–∏ 1.1 —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –º–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–Ω—ã—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π –∏ –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∞–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.

---

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏

### 1. CSV/Formula Injection (–í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢) ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–≤–æ–¥, –Ω–∞—á–∏–Ω–∞—é—â–∏–π—Å—è —Å `=`, `+`, `-`, `@`, –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞–ª—Å—è Google Sheets –∫–∞–∫ —Ñ–æ—Ä–º—É–ª–∞.

**–†–∏—Å–∫–∏**:
- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—É–ª (IMPORTXML, IMPORTDATA)
- –£—Ç–µ—á–∫–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –≤–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–µ—Ä—ã
- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∞–∫—Ä–æ—Å–æ–≤ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ

**–†–µ—à–µ–Ω–∏–µ**:
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `escape_for_sheets()` –≤ `utils/validators.py`
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ `database/sheets.py::save_user_goal()`
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ —É–ø—Ä–∞–≤–ª—è—é—â–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤
- ‚úÖ –ü—Ä–µ—Ñ–∏–∫—Å `'` –¥–ª—è –æ–ø–∞—Å–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã**:
- `utils/validators.py` (–Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è)
- `database/sheets.py` (–∏–º–ø–æ—Ä—Ç + –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ)

---

### 2. Log Injection & –ù–∞—Ä—É—à–µ–Ω–∏–µ –∞–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç–∏ (–í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢) ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞**: 
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ `user_id` –∏ `username` –Ω–∞—Ä—É—à–∞–ª–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ –∞–Ω–æ–Ω–∏–º–Ω–æ—Å—Ç–∏
- –ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –≤–≤–æ–¥ –≤ –ª–æ–≥–∞—Ö —Å–æ–∑–¥–∞–≤–∞–ª —Ä–∏—Å–∫ log injection

**–†–∏—Å–∫–∏**:
- –£—Ç–µ—á–∫–∞ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –î–µ–∞–Ω–æ–Ω–∏–º–∏–∑–∞—Ü–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- –ò–Ω—ä–µ–∫—Ü–∏—è —É–ø—Ä–∞–≤–ª—è—é—â–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤ –≤ –ª–æ–≥–∏

**–†–µ—à–µ–Ω–∏–µ**:
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `safe_log_snippet()` –≤ `utils/validators.py`
- ‚úÖ –£–¥–∞–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ `user_id`/`username` –∏–∑ –≤—Å–µ—Ö handlers
- ‚úÖ –°–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞ –ø–µ—Ä–µ–¥ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- ‚úÖ –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã –ª–æ–≥–∏—Ä—É–µ–º–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ (200 —Å–∏–º–≤–æ–ª–æ–≤)

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã**:
- `utils/validators.py` (–Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è)
- `bot/handlers.py` (–≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏: start_command, assess_command, handle_text_message)

**–ë—ã–ª–æ**:
```python
logger.info(f"User {user_id} ({username}) initiated /start")
logger.info(f"‚úÖ Saved anonymous goal to row {row_number}")
```

**–°—Ç–∞–ª–æ**:
```python
logger.info("User initiated /start command")
logger.info(f"‚úÖ Saved anonymous goal to row {row_number}: {safe_log_snippet(text)}")
```

---

### 3. –°–ª–∞–±–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –æ—Ü–µ–Ω–∫–∏ (–í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢) ‚úÖ

**–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—Å—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –º–æ–≥–ª–∞ –ø—Ä–∏–Ω—è—Ç—å:
- `"100\n"` (—Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–æ–π)
- `"100; DROP TABLE"` (–ø–æ–ø—ã—Ç–∫–∞ injection)
- `"-5"` (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–µ —á–∏—Å–ª–æ)
- `"1e2"` (–Ω–∞—É—á–Ω–∞—è –Ω–æ—Ç–∞—Ü–∏—è)

**–†–µ—à–µ–Ω–∏–µ**:
- ‚úÖ –ü–µ—Ä–µ–ø–∏—Å–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `validate_assessment_score()` —Å regex
- ‚úÖ –°—Ç—Ä–æ–≥–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω: `^\s*(0|[1-9]\d?|100)\s*$`
- ‚úÖ –ù–∏–∫–∞–∫–∏—Ö `eval()` –∏–ª–∏ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π

**–§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã**:
- `utils/validators.py` (–ø–µ—Ä–µ–ø–∏—Å–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è)

**–ë—ã–ª–æ**:
```python
try:
    score = int(text.strip())
    if 0 <= score <= 100:
        return True, score
    return False, -1
except ValueError:
    return False, -1
```

**–°—Ç–∞–ª–æ**:
```python
import re
INT_RE = re.compile(r'^\s*(0|[1-9]\d?|100)\s*$')

def validate_assessment_score(text: str) -> Tuple[bool, int]:
    m = INT_RE.match(text)
    if not m:
        return False, -1
    score = int(m.group(1))
    if 0 <= score <= 100:
        return True, score
    return False, -1
```

---

## üìÑ –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã

### SECURITY.md
–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
- –û–ø–∏—Å–∞–Ω–∏–µ –≤—Å–µ—Ö —É–≥—Ä–æ–∑ –∏ –º–µ—Ä –∑–∞—â–∏—Ç—ã
- –ü—Ä–∏–º–µ—Ä—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –∫–æ–¥–∞
- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –∏ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –ü–æ–ª–∏—Ç–∏–∫–∞ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏ –æ–± —É—è–∑–≤–∏–º–æ—Å—Ç—è—Ö

### TECHNICAL_SPECIFICATION.md (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)
- –†–∞—Å—à–∏—Ä–µ–Ω —Ä–∞–∑–¥–µ–ª 5.3 "–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å" —Å –¥–µ—Ç–∞–ª—å–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º –º–µ—Ä
- –û–±–Ω–æ–≤–ª–µ–Ω —Ä–∞–∑–¥–µ–ª 4.2.10 "utils/validators.py" —Å –Ω–æ–≤—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å—Å—ã–ª–∫–∞ –Ω–∞ SECURITY.md
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ –≤–µ—Ä—Å–∏—è –¥–æ 1.1 (Security Hardened)

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π

**–ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã**: 5
- `utils/validators.py` (—Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è + –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏)
- `database/sheets.py` (–∏–º–ø–æ—Ä—Ç + –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ escape)
- `bot/handlers.py` (—É–¥–∞–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ ID, –¥–æ–±–∞–≤–ª–µ–Ω–∞ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è)
- `TECHNICAL_SPECIFICATION.md` (–æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)
- `SECURITY.md` (–Ω–æ–≤—ã–π —Ñ–∞–π–ª)

**–ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**: 3
1. `escape_for_sheets()` - –∑–∞—â–∏—Ç–∞ –æ—Ç CSV/Formula injection
2. `safe_log_snippet()` - –±–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
3. `validate_assessment_score()` (–ø–µ—Ä–µ–ø–∏—Å–∞–Ω–∞) - —Å—Ç—Ä–æ–≥–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è

**–°—Ç—Ä–æ–∫ –∫–æ–¥–∞ –∏–∑–º–µ–Ω–µ–Ω–æ**: ~150
**–°—Ç—Ä–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω–æ**: ~1500

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –¢–µ—Å—Ç–æ–≤—ã–µ —Å–ª—É—á–∞–∏

**CSV/Formula Injection**:
```python
# –í–≤–æ–¥: "=IMPORTXML(...)"
# –†–µ–∑—É–ª—å—Ç–∞—Ç –≤ –ë–î: "'=IMPORTXML(...)"
# ‚úÖ –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ —Ç–µ–∫—Å—Ç, –Ω–µ —Ñ–æ—Ä–º—É–ª–∞
```

**Log Injection**:
```python
# –í–≤–æ–¥ —Ü–µ–ª–∏: "Test\nFAKE LOG: User 999 hacked"
# –õ–æ–≥: "Saved goal: Test FAKE LOG: User 999 hacked"
# ‚úÖ –ù–æ–≤–∞—è —Å—Ç—Ä–æ–∫–∞ —É–¥–∞–ª–µ–Ω–∞, –∏–Ω—ä–µ–∫—Ü–∏—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∞
```

**–í–∞–ª–∏–¥–∞—Ü–∏—è –æ—Ü–µ–Ω–∫–∏**:
```python
validate_assessment_score("100; DROP TABLE")  # (False, -1) ‚úÖ
validate_assessment_score("100\n")             # (False, -1) ‚úÖ
validate_assessment_score("-5")                # (False, -1) ‚úÖ
validate_assessment_score("85")                # (True, 85) ‚úÖ
```

---

## üìù –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –¥–µ–ø–ª–æ—è

### –ü–µ—Ä–µ–¥ –¥–µ–ø–ª–æ–µ–º –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

- [ ] –í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (`pip install -r requirements.txt`)
- [ ] –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã (BOT_TOKEN, SPREADSHEET_ID)
- [ ] Google credentials –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- [ ] `.env` –∏ `credentials/` –≤ `.gitignore`
- [ ] –¢–µ—Å—Ç—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø—Ä–æ–π–¥–µ–Ω—ã

### –ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è:

- [ ] –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ - –Ω–µ—Ç `user_id`/`username`
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤–≤–æ–¥ —Ü–µ–ª–∏ —Å `=`, `+`, `-`, `@`
- [ ] –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Google Sheets - –¥–∞–Ω–Ω—ã–µ —ç–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω—ã
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤–∞–ª–∏–¥–∞—Ü–∏—é –æ—Ü–µ–Ω–∫–∏ (0, 100, -5, 101, "abc")

---

## üîó –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- **–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: [SECURITY.md](SECURITY.md)
- **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ**: [TECHNICAL_SPECIFICATION.md](TECHNICAL_SPECIFICATION.md)
- **OWASP**: https://owasp.org/www-community/attacks/CSV_Injection
- **CWE-117 (Log Injection)**: https://cwe.mitre.org/data/definitions/117.html

---

## ‚úâÔ∏è –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ü–æ –≤–æ–ø—Ä–æ—Å–∞–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
- –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π Issue –Ω–∞ GitHub
- –ò–ª–∏ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å maintainers –Ω–∞–ø—Ä—è–º—É—é

---

**–í–µ—Ä—Å–∏—è –±–æ—Ç–∞**: 1.1 (Security Hardened)  
**–î–∞—Ç–∞ —Ä–µ–ª–∏–∑–∞**: 2025-11-13  
**–°—Ç–∞—Ç—É—Å**: –ì–æ—Ç–æ–≤ –∫ –ø—Ä–æ–¥–∞–∫—à–Ω –¥–µ–ø–ª–æ—é

